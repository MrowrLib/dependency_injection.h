TODO:
- [ ] Add support for passing a lambda for the factory